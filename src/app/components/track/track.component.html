<div class="track-container">
  <!-- Breadcrumb Navigation -->
  <app-breadcrumb [breadcrumbs]="breadcrumbs"></app-breadcrumb>

  <!-- Track Header -->
  <div class="track-header" *ngIf="track && !loading">
    <div class="container">
      <div class="track-info">
        <div class="track-image">
          <img
            [src]="getImageUrl(track.album.images)"
            [alt]="track.album.name"
          />
          <div class="play-overlay" (click)="playTrack()">
            <i class="fas fa-play"></i>
          </div>
        </div>
        <div class="track-details">
          <h1 class="track-name">{{ track.name }}</h1>
          <p class="track-artist">
            <a
              [routerLink]="['/artist', artist.id]"
              *ngFor="let artist of track.artists; let last = last"
            >
              {{ artist.name }}<span *ngIf="!last">, </span>
            </a>
          </p>
          <p class="track-album">
            <a [routerLink]="['/album', track.album.id]">{{
              track.album.name
            }}</a>
          </p>
          <div class="track-meta">
            <div class="meta-item">
              <i class="fas fa-clock"></i>
              <span>{{ formatDuration(track.duration_ms) }}</span>
            </div>
            <div class="meta-item">
              <i class="fas fa-fire"></i>
              <span>{{ track.popularity }}% popular</span>
            </div>
            <div class="meta-item">
              <i class="fas fa-calendar"></i>
              <span>{{ track.album.release_date | date : "yyyy" }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State for Track Header -->
  <div class="track-header loading" *ngIf="loading">
    <div class="container">
      <div class="track-info">
        <div class="track-image placeholder-glow">
          <span
            class="placeholder"
            style="width: 200px; height: 200px; border-radius: 15px"
          ></span>
        </div>
        <div class="track-details">
          <div class="placeholder-glow">
            <span
              class="placeholder col-8"
              style="height: 2rem; margin-bottom: 1rem"
            ></span>
            <span
              class="placeholder col-6"
              style="height: 1.5rem; margin-bottom: 1rem"
            ></span>
            <span
              class="placeholder col-4"
              style="height: 1.2rem; margin-bottom: 1.5rem"
            ></span>
            <span class="placeholder col-3" style="height: 1rem"></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Enhanced Audio Player Section -->
    <section class="audio-section" *ngIf="track && !loading">
      <div class="audio-player-card">
        <!-- Main Player Area -->
        <div class="player-main">
          <div class="player-image-container">
            <img
              [src]="getImageUrl(track.album.images)"
              [alt]="track.album.name"
              class="player-image"
            />
            <div class="play-overlay" (click)="playTrack()">
              <div class="play-button">
                <i
                  class="fas fa-play"
                  *ngIf="!isTrackPlaying() && !isTrackSearchingPreview()"
                ></i>
                <i class="fas fa-pause" *ngIf="isTrackPlaying()"></i>
                <i
                  class="fas fa-spinner fa-spin"
                  *ngIf="isTrackSearchingPreview()"
                ></i>
              </div>
            </div>
          </div>

          <div class="player-content">
            <h2 class="player-title">{{ track.name }}</h2>
            <p class="player-artist">{{ getArtistNames(track.artists) }}</p>
            <p class="player-album">from {{ track.album.name }}</p>

            <!-- Track Info -->
            <div class="track-meta">
              <div class="meta-item">
                <i class="fas fa-clock"></i>
                <span>{{ formatDuration(track.duration_ms) }}</span>
              </div>
              <div class="meta-item">
                <i class="fas fa-fire"></i>
                <span>{{ track.popularity }}% popular</span>
              </div>
              <div class="meta-item">
                <i class="fas fa-calendar"></i>
                <span>{{ track.album.release_date | date : "yyyy" }}</span>
              </div>
              <div class="meta-item" *ngIf="hasPreviewUrl()">
                <i class="fas fa-check-circle"></i>
                <span>Preview Available</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="player-actions" *ngIf="track?.external_urls?.spotify">
          <button class="action-btn spotify" (click)="openInSpotify()">
            <i class="fab fa-spotify"></i>
            <span>Open in Spotify</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Album Information Section -->
    <section class="section" *ngIf="track && !loading">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-compact-disc"></i> From Album
        </h2>
      </div>

      <div class="album-info-card">
        <div class="album-image">
          <img
            [src]="getImageUrl(track.album.images)"
            [alt]="track.album.name"
          />
        </div>
        <div class="album-details">
          <h3 class="album-name">{{ track.album.name }}</h3>
          <p class="album-artist">{{ getArtistNames(track.album.artists) }}</p>
          <div class="album-meta">
            <span class="album-date">{{
              track.album.release_date | date : "MMM d, yyyy"
            }}</span>
            <span class="album-tracks"
              >{{ track.album.total_tracks }} tracks</span
            >
          </div>
          <div class="album-actions">
            <button class="album-btn" [routerLink]="['/album', track.album.id]">
              <i class="fas fa-eye"></i>
              <span>View Album</span>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p>Loading track information...</p>
    </div>

    <!-- Error State -->
    <div class="error-container" *ngIf="!loading && !track">
      <div class="error-content">
        <i class="fas fa-exclamation-triangle"></i>
        <h3>Track Not Found</h3>
        <p>The track you're looking for could not be found.</p>
        <a routerLink="/search" class="btn btn-primary">
          <i class="fas fa-search"></i> Search for Music
        </a>
      </div>
    </div>
  </div>
</div>
