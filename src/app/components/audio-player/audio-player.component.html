<div class="player">
  <div class="p-trk">
    <div class="p-th">
      <img
        *ngIf="
          currentTrack
            ? getImageUrl(currentTrack.album?.images)
            : getPlaceholderImage()
        "
        [src]="
          currentTrack
            ? getImageUrl(currentTrack.album?.images)
            : getPlaceholderImage()
        "
        [alt]="currentTrack?.album?.name || 'No Track'"
      />
    </div>
    <div style="min-width: 0">
      <div class="p-nm">{{ currentTrack?.name || "No track selected" }}</div>
      <div class="p-ar">
        {{
          currentTrack
            ? getArtistNames(currentTrack.artists || [])
            : "Select a track to play"
        }}
      </div>
    </div>
  </div>
  <div class="p-ctrl">
    <div class="p-btns">
      <button
        class="c-btn sm"
        (click)="toggleShuffle()"
        [class.active]="isShuffled"
      >
        <i class="fa-solid fa-shuffle"></i>
      </button>
      <button class="c-btn" (click)="previousTrack()">
        <i class="fa-solid fa-backward-step"></i>
      </button>
      <button class="pb" (click)="togglePlayPause()">
        <i
          class="fa-solid"
          [class.fa-play]="!isPlaying"
          [class.fa-pause]="isPlaying"
        ></i>
      </button>
      <button class="c-btn" (click)="nextTrack()">
        <i class="fa-solid fa-forward-step"></i>
      </button>
      <button
        class="c-btn sm"
        (click)="toggleRepeat()"
        [class.active]="repeatMode !== 'none'"
      >
        <i class="fa-solid fa-repeat"></i>
      </button>
    </div>
    <div class="prog">
      <span class="pt">{{
        currentTrack ? formatTime(currentTime) : "0:00"
      }}</span>
      <div class="pbar" (click)="seekTo($event)">
        <div
          class="pfill"
          [style.width.%]="duration ? (currentTime / duration) * 100 : 0"
        ></div>
      </div>
      <span class="pt e">{{
        currentTrack ? formatTime(duration) : "0:00"
      }}</span>
    </div>
  </div>
  <div class="p-right">
    <div class="p-vol">
      <button class="v-btn" (click)="toggleMute()">
        <i
          class="fa-solid"
          [class.fa-volume-high]="!isMuted"
          [class.fa-volume-xmark]="isMuted"
        ></i>
      </button>
      <div class="v-bar" (click)="setVolume($event)">
        <div class="vfill" [style.width.%]="volume * 100"></div>
      </div>
      <span class="v-pct">{{ volume * 100 | number: "1.0-0" }}%</span>
    </div>
  </div>

  <audio
    #audioElement
    (timeupdate)="onTimeUpdate()"
    (loadedmetadata)="onLoadedMetadata()"
    (ended)="onEnded()"
    [volume]="volume"
    [muted]="isMuted"
  ></audio>
</div>
